import { browser } from '$app/environment';
import { derived, writable } from 'svelte/store';

export type Locale = 'id' | 'en';
export type LocalizedString = { id: string; en: string };

export const localeOptions: { id: Locale; label: string }[] = [
	{ id: 'id', label: 'ID' },
	{ id: 'en', label: 'EN' }
];

const defaultLocale: Locale = 'id';
const storedLocale = browser ? localStorage.getItem('locale') : null;
const initialLocale: Locale = storedLocale === 'en' || storedLocale === 'id' ? storedLocale : defaultLocale;

export const locale = writable<Locale>(initialLocale);

locale.subscribe((value) => {
	if (!browser) return;
	localStorage.setItem('locale', value);
	document.documentElement.lang = value;
});

const translations: Record<Locale, Record<string, string>> = {
	id: {
		'meta.title': 'TravelGenZ - Jelajahi Sesukamu',
		'nav.home': 'Beranda',
		'nav.packages': 'Paket',
		'nav.about': 'Tentang',
		'nav.gallery': 'Galeri',
		'nav.reviews': 'Ulasan',
		'nav.contact': 'Kontak',
		'nav.bookNow': 'Book Now',
		'nav.tagline': 'Petualanganmu Dimulai Di Sini',
		'theme.switchToLight': 'Ganti ke Light Mode',
		'theme.switchToDark': 'Ganti ke Dark Mode',
		'mobile.note': 'Siap liburan? Konsultasi trip bisa langsung via WhatsApp.',
		'hero.title': 'WONDERFUL INDONESIA',
		'hero.subtitle': 'Explore the World Your Way!',
		'hero.description':
			'Temukan petualangan epic, ciptakan momen tak terlupakan, dan traveling dengan cara baru. Trip sempurna untuk Gen Z explorer.',
		'hero.explore': 'Explore Packages',
		'hero.viewGallery': 'View Gallery',
		'packages.title': 'Petualangan Epik Menantimu',
		'packages.subtitle':
			'Destinasi pilihan yang dikurasi khusus untukmu. Temukan perjalanan tak terlupakan berikutnya!',
		'packages.searchPlaceholder': 'Cari destinasi atau paket',
		'packages.featured': 'UNGULAN',
		'packages.save': 'HEMAT {percent}%',
		'packages.perPerson': 'per orang',
		'packages.view': 'Lihat',
		'packages.bookNow': 'Book Now',
		'packages.reviews': '{count} ulasan',
		'stats.destinations': 'Destinasi',
		'stats.happyTravelers': 'Traveler Bahagia',
		'stats.averageRating': 'Rating Rata-rata',
		'stats.support': 'Dukungan',
		'difficulty.easy': 'Mudah',
		'difficulty.moderate': 'Sedang',
		'difficulty.hard': 'Sulit',
		'gallery.kicker': 'Galeri Foto',
		'gallery.title': 'Foto dari Para Traveler',
		'gallery.subtitle': 'Momen terbaik dari petualangan traveler kami di destinasi impian Indonesia.',
		'reviews.title': 'Apa Kata ',
		'reviews.titleAccent': 'Traveler Kami',
		'reviews.subtitle': 'Cerita nyata dari petualang sejati. Lihat kenapa ribuan orang jatuh cinta.',
		'cta.kicker': 'Call To Action',
		'cta.title': 'Siap Liburan Tak Terlupakan?',
		'cta.body':
			'Yuk rencanakan trip impianmu sekarang. Kami siap bantu itinerary, budget, dan rekomendasi spot terbaik biar perjalananmu makin seru.',
		'cta.button': 'Hubungi via WhatsApp',
		'cta.whatsappMessage': 'Halo TravelGenZ! Saya ingin konsultasi trip dan booking paket wisata.',
		'footer.tagline': 'Teman perjalanan terbaik',
		'footer.description':
			'Teman perjalanan terbaik untuk petualangan seru di seluruh dunia. Dibuat untuk Gen Z, oleh Gen Z.',
		'footer.quickLinks': 'Tautan Cepat',
		'footer.support': 'Bantuan',
		'footer.newsletter': 'Newsletter',
		'footer.newsletterDesc': 'Berlangganan untuk promo eksklusif dan tips traveling.',
		'footer.subscribe': 'Berlangganan',
		'footer.emailPlaceholder': 'email@anda.com',
		'footer.rights': '2026 TravelGenZ. All rights reserved. Made with care for adventurers.',
		'footer.terms': 'Syarat',
		'footer.privacy': 'Privasi',
		'footer.cookies': 'Cookies',
		'footer.helpCenter': 'Pusat Bantuan',
		'footer.termsConditions': 'Syarat & Ketentuan',
		'footer.privacyPolicy': 'Kebijakan Privasi',
		'footer.cancelPolicy': 'Kebijakan Pembatalan',
		'footer.faq': 'FAQ',
		'footer.aboutUs': 'Tentang Kami',
		'payment.kicker': 'Smart Payment',
		'payment.title': 'Bayar trip sesuai gaya kamu',
		'payment.noDatabase': 'Tanpa database',
		'payment.step.choose': 'Pilih',
		'payment.step.customize': 'Sesuaikan',
		'payment.step.pay': 'Bayar',
		'payment.selectPackage': 'Pilih paket',
		'payment.travelers': 'Peserta',
		'payment.addons': 'Add-on',
		'payment.promoCode': 'Kode promo',
		'payment.paymentMethod': 'Metode pembayaran',
		'payment.installmentPlan': 'Skema cicilan',
		'payment.orderSummary': 'Ringkasan pesanan',
		'payment.secure': 'Aman',
		'payment.basePrice': 'Harga dasar',
		'payment.addonsLabel': 'Add-on',
		'payment.serviceFee': 'Biaya layanan',
		'payment.promo': 'Promo',
		'payment.planFee': 'Biaya cicilan',
		'payment.total': 'Total',
		'payment.paySchedule': 'Bayar {count}x - hari ini {amount}',
		'payment.payNow': 'Bayar Sekarang',
		'payment.note': 'Pembayaran ini simulasi demo. Tidak memerlukan database.',
		'booking.title': 'Pesan Petualangan',
		'booking.fullName': 'Nama Lengkap *',
		'booking.fullNamePlaceholder': 'Nama lengkap kamu',
		'booking.email': 'Email *',
		'booking.emailPlaceholder': 'emailkamu@email.com',
		'booking.phone': 'Nomor HP *',
		'booking.phonePlaceholder': 'nomor HP kamu',
		'booking.participants': 'Jumlah Peserta *',
		'booking.address': 'Alamat *',
		'booking.addressPlaceholder': 'Alamat lengkap kamu',
		'booking.date': 'Tanggal Perjalanan *',
		'booking.requests': 'Permintaan Khusus (Opsional)',
		'booking.requestsPlaceholder': 'Ada kebutuhan khusus atau diet tertentu?',
		'booking.pricePerPerson': 'Harga per orang:',
		'booking.participantsLabel': 'Peserta:',
		'booking.totalAmount': 'Total Pembayaran:',
		'booking.paymentInfoTitle': 'Informasi Pembayaran:',
		'booking.paymentInfoText':
			'Setelah mengirim form ini, kamu akan menerima instruksi pembayaran via email. Kami mendukung metode pembayaran lewat Midtrans (Bank Transfer, E-Wallet, Kartu Kredit).',
		'booking.cancel': 'Batal',
		'booking.confirm': 'Konfirmasi Booking',
		'cart.title': 'Your Trip Cart',
		'cart.subtitle': 'Paket dari Epic Adventures Await',
		'cart.empty': 'Cart kosong. Klik Book Now lagi untuk memuat semua paket.',
		'cart.participants': 'Peserta:',
		'cart.close': 'Tutup',
		'cart.checkout': 'Checkout',
		'paymentModal.title': 'Detail Pembayaran',
		'paymentModal.subtitle': 'Bukti pembayaran untuk {name}',
		'paymentModal.reference': 'Referensi',
		'paymentModal.status': 'Status',
		'paymentModal.statusPending': 'Pending',
		'paymentModal.expires': 'Berlaku sampai',
		'paymentModal.tripSummary': 'Ringkasan Trip',
		'paymentModal.participants': 'Peserta',
		'paymentModal.total': 'Total',
		'paymentModal.methodTitle': 'Metode Pembayaran',
		'paymentModal.bankVA': 'Bank Virtual Account',
		'paymentModal.vaNumber': 'Nomor VA',
		'paymentModal.amount': 'Nominal',
		'paymentModal.close': 'Tutup',
		'paymentModal.confirm': 'Konfirmasi Pembayaran',
		'detail.kicker': 'Detail Destinasi',
		'detail.overview': 'Ringkasan',
		'detail.highlights': 'Highlight Terbaik',
		'detail.itinerary': 'Itinerary',
		'detail.included': 'Yang Termasuk',
		'detail.tips': 'Tips',
		'detail.gallery': 'Galeri',
		'detail.ready': 'Siap berangkat?',
		'detail.readySubtitle': 'Yuk booking petualanganmu.',
		'detail.openPage': 'Buka Halaman',
		'detail.close': 'Tutup',
		'detail.backToPackages': 'Kembali ke Paket',
		'detail.backToHome': 'Kembali ke Beranda',
		'detail.bookNow': 'Book Now',
		'detail.destinationDetail': 'Detail Destinasi',
		'wa.bookingMessage':
			'Halo TravelGenZ! Saya ingin booking trip.\n\nTrip: {trip}\nNama: {name}\nEmail: {email}\nNo. HP: {phone}\nPeserta: {participants}\nTanggal: {date}\nAlamat: {address}\nCatatan: {note}\nTotal: {total}',
		'wa.paymentMessage':
			'Halo TravelGenZ! Saya sudah melakukan pembayaran.\n\nRef: {ref}\nNama: {name}\nPaket:\n{items}\n\nTotal: {total}\nVA: {va}\nStatus: Pending'
	},
	en: {
		'meta.title': 'TravelGenZ - Explore Your Way',
		'nav.home': 'Home',
		'nav.packages': 'Packages',
		'nav.about': 'About',
		'nav.gallery': 'Gallery',
		'nav.reviews': 'Reviews',
		'nav.contact': 'Contact',
		'nav.bookNow': 'Book Now',
		'nav.tagline': 'Your Adventure Starts Here',
		'theme.switchToLight': 'Switch to Light Mode',
		'theme.switchToDark': 'Switch to Dark Mode',
		'mobile.note': 'Ready to travel? Chat with us on WhatsApp for a quick consult.',
		'hero.title': 'WONDERFUL INDONESIA',
		'hero.subtitle': 'Explore the World Your Way!',
		'hero.description':
			'Discover epic adventures, make unforgettable memories, and travel like never before. Perfect trips for the Gen Z explorer in you.',
		'hero.explore': 'Explore Packages',
		'hero.viewGallery': 'View Gallery',
		'packages.title': 'Epic Adventures Await',
		'packages.subtitle':
			'Handpicked destinations curated just for you. Find your next unforgettable journey!',
		'packages.searchPlaceholder': 'Search destinations or packages',
		'packages.featured': 'FEATURED',
		'packages.save': 'SAVE {percent}%',
		'packages.perPerson': 'per person',
		'packages.view': 'View',
		'packages.bookNow': 'Book Now',
		'packages.reviews': '{count} reviews',
		'stats.destinations': 'Destinations',
		'stats.happyTravelers': 'Happy Travelers',
		'stats.averageRating': 'Average Rating',
		'stats.support': 'Support',
		'difficulty.easy': 'Easy',
		'difficulty.moderate': 'Moderate',
		'difficulty.hard': 'Hard',
		'gallery.kicker': 'Photo Gallery',
		'gallery.title': "Photo's From Travellers",
		'gallery.subtitle': 'Best moments from our travelers in Indonesia dream destinations.',
		'reviews.title': 'What Our ',
		'reviews.titleAccent': 'Travelers Say',
		'reviews.subtitle': 'Real stories from real adventurers. See why thousands love traveling with us.',
		'cta.kicker': 'Call To Action',
		'cta.title': 'Ready for an Unforgettable Trip?',
		'cta.body':
			"Let's plan your dream trip. We can help with itineraries, budgets, and the best spots so your journey stays unforgettable.",
		'cta.button': 'Contact via WhatsApp',
		'cta.whatsappMessage': 'Hello TravelGenZ! I want to consult and book a travel package.',
		'footer.tagline': 'Your ultimate travel companion',
		'footer.description':
			'Your ultimate travel companion for epic adventures around the world. Made for Gen Z, by Gen Z.',
		'footer.quickLinks': 'Quick Links',
		'footer.support': 'Support',
		'footer.newsletter': 'Newsletter',
		'footer.newsletterDesc': 'Subscribe for exclusive deals and travel tips.',
		'footer.subscribe': 'Subscribe',
		'footer.emailPlaceholder': 'your@email.com',
		'footer.rights': '2026 TravelGenZ. All rights reserved. Made with care for adventurers.',
		'footer.terms': 'Terms',
		'footer.privacy': 'Privacy',
		'footer.cookies': 'Cookies',
		'footer.helpCenter': 'Help Center',
		'footer.termsConditions': 'Terms & Conditions',
		'footer.privacyPolicy': 'Privacy Policy',
		'footer.cancelPolicy': 'Cancellation Policy',
		'footer.faq': 'FAQ',
		'footer.aboutUs': 'About Us',
		'payment.kicker': 'Smart Payment',
		'payment.title': 'Pay your trip your way',
		'payment.noDatabase': 'No database required',
		'payment.step.choose': 'Choose',
		'payment.step.customize': 'Customize',
		'payment.step.pay': 'Pay',
		'payment.selectPackage': 'Select package',
		'payment.travelers': 'Travelers',
		'payment.addons': 'Add-ons',
		'payment.promoCode': 'Promo code',
		'payment.paymentMethod': 'Payment method',
		'payment.installmentPlan': 'Installment plan',
		'payment.orderSummary': 'Order summary',
		'payment.secure': 'Secure',
		'payment.basePrice': 'Base price',
		'payment.addonsLabel': 'Add-ons',
		'payment.serviceFee': 'Service fee',
		'payment.promo': 'Promo',
		'payment.planFee': 'Plan fee',
		'payment.total': 'Total',
		'payment.paySchedule': 'Paying {count}x - due today {amount}',
		'payment.payNow': 'Pay Now',
		'payment.note': 'Payment is simulated for demo purposes. No database required.',
		'booking.title': 'Book Your Adventure',
		'booking.fullName': 'Full Name *',
		'booking.fullNamePlaceholder': 'Your full name',
		'booking.email': 'Email *',
		'booking.emailPlaceholder': 'youremail@email.com',
		'booking.phone': 'Phone Number *',
		'booking.phonePlaceholder': 'your phone number',
		'booking.participants': 'Number of Participants *',
		'booking.address': 'Address *',
		'booking.addressPlaceholder': 'Your full address',
		'booking.date': 'Preferred Travel Date *',
		'booking.requests': 'Special Requests (Optional)',
		'booking.requestsPlaceholder': 'Any special requirements or dietary restrictions?',
		'booking.pricePerPerson': 'Price per person:',
		'booking.participantsLabel': 'Participants:',
		'booking.totalAmount': 'Total Amount:',
		'booking.paymentInfoTitle': 'Payment Information:',
		'booking.paymentInfoText':
			'After submitting this form, you will receive payment instructions via email. We support various payment methods through Midtrans (Bank Transfer, E-Wallet, Credit Card).',
		'booking.cancel': 'Cancel',
		'booking.confirm': 'Confirm Booking',
		'cart.title': 'Your Trip Cart',
		'cart.subtitle': 'Packages from Epic Adventures Await',
		'cart.empty': 'Your cart is empty. Click Book Now again to load all packages.',
		'cart.participants': 'Participants:',
		'cart.close': 'Close',
		'cart.checkout': 'Checkout',
		'paymentModal.title': 'Payment Details',
		'paymentModal.subtitle': 'Payment receipt for {name}',
		'paymentModal.reference': 'Reference',
		'paymentModal.status': 'Status',
		'paymentModal.statusPending': 'Pending',
		'paymentModal.expires': 'Expires',
		'paymentModal.tripSummary': 'Trip Summary',
		'paymentModal.participants': 'Participants',
		'paymentModal.total': 'Total',
		'paymentModal.methodTitle': 'Payment Method',
		'paymentModal.bankVA': 'Bank Virtual Account',
		'paymentModal.vaNumber': 'VA Number',
		'paymentModal.amount': 'Amount',
		'paymentModal.close': 'Close',
		'paymentModal.confirm': 'Confirm Payment',
		'detail.kicker': 'Destination Detail',
		'detail.overview': 'Overview',
		'detail.highlights': 'Top Highlights',
		'detail.itinerary': 'Itinerary',
		'detail.included': "What's Included",
		'detail.tips': 'Tips',
		'detail.gallery': 'Gallery',
		'detail.ready': 'Ready to go?',
		'detail.readySubtitle': "Let's book your adventure.",
		'detail.openPage': 'Open Full Page',
		'detail.close': 'Close',
		'detail.backToPackages': 'Back to Packages',
		'detail.backToHome': 'Back to Home',
		'detail.bookNow': 'Book Now',
		'detail.destinationDetail': 'Destination Detail',
		'wa.bookingMessage':
			'Hello TravelGenZ! I want to book a trip.\n\nTrip: {trip}\nName: {name}\nEmail: {email}\nPhone: {phone}\nParticipants: {participants}\nDate: {date}\nAddress: {address}\nNotes: {note}\nTotal: {total}',
		'wa.paymentMessage':
			'Hello TravelGenZ! I have completed payment.\n\nRef: {ref}\nName: {name}\nPackages:\n{items}\n\nTotal: {total}\nVA: {va}\nStatus: Pending'
	}
};

const interpolate = (template: string, vars: Record<string, string | number>) =>
	template.replace(/\{(\w+)\}/g, (_, key) => `${vars[key] ?? ''}`);

export const t = derived(locale, ($locale) => (key: string, vars: Record<string, string | number> = {}) => {
	const value = translations[$locale]?.[key] ?? translations.en?.[key] ?? key;
	return interpolate(value, vars);
});

export const localize = (value: LocalizedString | string, currentLocale: Locale) => {
	if (typeof value === 'string') return value;
	return value?.[currentLocale] ?? value?.en ?? value?.id ?? '';
};
